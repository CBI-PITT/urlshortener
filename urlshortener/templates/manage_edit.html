{% extends 'base.html' %}
{% block content %}
  <h1>Edit: <code>{{ slug }}</code></h1>
  <p class="muted">Created {{ rec['created_at'] }} • Clicks {{ rec['clicks'] }}{% if rec['expires_at'] %} • Expires {{ rec['expires_at'] }}{% endif %}</p>
  <form method="post" action="{{ url_for('manage', slug=slug) + '?key=' + key }}">
    <label for="target">Target URL</label>
    <input type="url" required name="target" id="target" value="{{ rec['target'] }}">

    <div class="row">
      <div>
        <label>Expiration</label>
        <label style="display:flex;gap:8px;align-items:center;">
          <input type="checkbox" id="never_expires" name="never_expires" value="1" {% if not rec['expires_at'] %}checked{% endif %}> Never expires
        </label>
        <input type="date" name="expires_date" id="expires_date" value="{{ rec['expires_date_input'] }}" {% if not rec['expires_at'] %}disabled{% endif %}>
        <input type="time" name="expires_time" id="expires_time" value="{{ rec['expires_time_input'] or '00:00' }}" {% if not rec['expires_at'] %}disabled{% endif %}>
        <p class="muted" style="margin:.25rem 0 0;">Leave blank or keep "Never expires" checked for links that never expire.</p>
        <script>
          const cb=document.getElementById('never_expires');
          const ed=document.getElementById('expires_date');
          const et=document.getElementById('expires_time');
          if(cb&&ed&&et){cb.addEventListener('change',()=>{ed.disabled=et.disabled=cb.checked; if(cb.checked){ed.value='';et.value='00:00';}});}
        </script>
      </div>
      <div>
        <label for="action">Action</label>
        <input type="text" id="action" name="action" value="update" placeholder="update | delete">
      </div>
    </div>

    <div class="btns">
      <button type="submit">Save changes</button>
      <button class="btn danger" name="action" value="delete" onclick="return confirm('Delete this link? This cannot be undone.')">Delete</button>
      <a class="btn secondary" href="{{ full_url }}" target="_blank">Open</a>
    </div>
  </form>
{% endblock %}